*bashsupport.txt*          bash Support             Last Change:  Nov 27 2004

bash Support                                     *bash-support* *bashsupport*
                            Plugin version 1.9
                      for Vim version 6.0 and above
                     Fritz Mehner  <mehner@fh-swf.de>

Write and run bash scripts using menus and hot keys (key mappings).

 1.     Usage with GUI                           |bashsupport-usage-gvim|     
 1.1     Menu 'Comments'                         |bashsupport-comm|     
 1.1.1   Append aligned comments                 |bashsupport-comm-1|
 1.1.2   Code to comment                         |bashsupport-comm-2|
 1.1.3   Comment to code                         |bashsupport-comm-3|
 1.1.4   Frame comments, file header, ...        |bashsupport-comm-4|
 1.1.5   KEYWORD + comment                       |bashsupport-comm-5|
 1.2     Menu 'Statements'                       |bashsupport-stat|     
 1.2.1    Normal mode, insert mode               |bashsupport-stat-1|
 1.2.2    Visual mode                            |bashsupport-stat-2|
 1.2.3    Code Snippets                          |bashsupport-stat-3|  
 1.3     Menu 'Set'                              |bashsupport-set|     
 1.4     Menu 'Run'                              |bashsupport-run|     
 1.4.1    Save and run                           |bashsupport-run-1|
 1.4.2    Save and check syntax                   |bashsupport-run-2|
 1.4.3    Command line arguments                 |bashsupport-run-3|
 1.4.4    Hardcopy                               |bashsupport-run-4|
 1.4.5    Xterm size                             |bashsupport-run-5|
 1.4.6    Output redirection                     |bashsupport-run-6|
 2.     Usage without GUI                        |bashsupport-usage-vim|      
 3.     Hotkeys                                  |bashsupport-hotkeys|        
 4.     Customization and configuration          |bashsupport-custom|  
 4.1     Files                                   |bashsupport-custom-1|  
 4.2     Global variables                        |bashsupport-custom-2|
 4.3     The root menu                           |bashsupport-custom-3|
 5.     Template files and tags                  |bashsupport-tempfiles| 
 5.1     Template files                          |bashsupport-tempfiles-1|    
 5.2     Tags                                    |bashsupport-tempfiles-2|
 6.     Bash Dictionary                          |bashsupport-dictionary|     
 7.     Release Notes                            |bashsupport-release-notes|  

        How to add this help file to Vim's help  |add-local-help|             


==============================================================================
1.  USAGE with GUI  (gVim)                            *bashsupport-usage-gvim*
==============================================================================

If the menus are not visible call them with the entry "Load Bash Support"
in the standard Tools-menu.

------------------------------------------------------------------------------
1.1  MENU 'Comments'                                        *bashsupport-comm*
------------------------------------------------------------------------------

1.1.1 APPEND ALIGNED COMMENTS TO CONSECUTIVE LINES        *bashsupport-comm-1*
--------------------------------------------------

In NORMAL MODE the menu entry
 'Line End Comm.' 
will append a comment to the current line.

In VISUAL MODE this entry will append aligned comments to all marked lines.
Marking the 4 lines

 x11=11;
 x1111=1111;
 
 x11111111=11111111;

and choosing 'Line End Comm.' will yield 

 x11=11;              # |
 x1111=1111;          # 
 
 x11111111=11111111;  # 

The cursor position is marked by | . Empty lines will be ignored.


1.1.2 CODE TO COMMENT                                     *bashsupport-comm-2*
---------------------

A marked block will be changed into

 #x11=11;
 #x1111=1111;
 #
 #x11111111=11111111;

The menu entry works also for a single line. A single line needs not to be
marked. 


1.1.3 COMMENT TO CODE                                     *bashsupport-comm-3*
---------------------

A marked block 

 #x11=11;
 x1111=1111;
 
 #x11111111=11111111;

will be changed into

 x11=11;
 x1111=1111;
 
 x11111111=11111111;

The menu entry works also for a single line. A single line needs not to be
marked. 


1.1.4 FRAME COMMENTS, FILE HEADER, ...                    *bashsupport-comm-4*
--------------------------------------

Frame comments, function descriptions and file header comments are read as
templates from the appropriate files (see |bashsupport-tempfiles|).


1.1.5 KEYWORD+comment                                     *bashsupport-comm-5*
---------------------

Preliminary line end comments to document (and find again) places where work
will be resumed shortly, like

   # :TODO:12.05.2004:Mn: <your comment>

Usually not meant for the final documentation.

------------------------------------------------------------------------------
1.2  MENU 'Statements'                                      *bashsupport-stat*
------------------------------------------------------------------------------

1.2.1  NORMAL MODE, INSERT MODE.                          *bashsupport-stat-1*
--------------------------------

An empty statement will be inserted and properly indented. The entry 'if'
will insert an if-statement:

 if 
 then
 fi

Inner statements will be indented.

1.2.1  VISUAL MODE                                        *bashsupport-stat-2*
------------------

The highlighted area (...) will be surrounded by a statement, parentheses,
quotes or an echo with quotes (for testing the complete expression):

  ${...}
  $(...)
  $((...))

  for in do ... done
  if then ... fi
  if then ... else fi
  select  in do ... done
  until do ... done
  while do ... done

  '...'
  "..."
  `...`

The echo-entry shows a special behavior:

 Normal mode: The complete line (from the first nonblank to the end) is 
              framed with  echo "..." ; the curser will be moved to the 
              next line.
 Visual mode: The highlighted text is framed with  echo "...".
 Insert mode: An empty echo "" will be inserted.

The remove-echo-entry:

 The keyword echo, the following double quotation mark and the last double
 quotation mark in the current line will be removed; the curser will be moved 
 to the next line.

------------------------------------------------------------------------------
1.2.3 CODE SNIPPETS                                       *bashsupport-stat-3*
------------------------------------------------------------------------------

Code snippets are pieces of code which are kept in separate files in a special
directory. File names are used to identify the snippets.  The default snippet
directory is  $HOME/.vim/codesnippets-bash.  Snippets are managed with the 3
entries 

   bash -> Statements -> read  code snippet
   bash -> Statements -> write code snippet
   bash -> Statements -> edit  code snippet

from the Statements submenu.

Creating a new snippet:  
-----------------------
When nothing is marked, "write code snippet" will write the whole buffer 
to a snippet file, otherwise the marked area will be written to a file.

Insert a snippet:
-----------------
Select the appropriate file from the snippet directory ("read  code snippet").
The inserted lines will be indented.

Indentation / no indentation
----------------------------
Code snippets are normally indented after insertion. To suppress indentation
add the file extension "ni" or "noindent" to the snippet file name, e.g.

  parameter_handling.sh.noindent


------------------------------------------------------------------------------
1.3  MENU 'Set'                                              *bashsupport-set*
------------------------------------------------------------------------------

Calling a set-command (submenu "Set") in NORMAL or INSERT MODE will set this
option, e.g.

 set -o posix

Calling a set-command (submenu "Set") for a marked block (VISUAL MODE)

 rm "$alldirs"
 echo "$alldirs gone"

will set this option above this block and unset it below:

 set -o xtrace            # OptionNumber_1
 rm "$alldirs"
 echo "$alldirs gone"
 set +o xtrace            # OptionNumber_1

The option numbers OptionNumber_xxx are automatically incremented. They can be 
searched for with the vim star command (*).


------------------------------------------------------------------------------
1.4  MENU 'Run'                                              *bashsupport-run*
------------------------------------------------------------------------------

1.4.1 Save and run                                         *bashsupport-run-1*
------------------

Save the current buffer to his file and run this file. The command line, the
applied parameters and the shell return code are shown in the bottom line.



1.4.2 Save and check syntax                                *bashsupport-run-2*
---------------------------

Save the current buffer to his file and run this file with the -n flag
(bash: Read commands but do not execute them).
Errors are listed in an error window; now the quickfix commands can be used.


1.4.3 Command line arguments                               *bashsupport-run-3*
----------------------------

The entry 'com. line arg.' calls an input dialog which asks for command line
arguments. These arguments are forwarded to the script which is run by the
'run' entry. The arguments are kept until you change them.

The arguments belong to the current buffer (that is, each buffer can have its 
own arguments).
If the buffer gets a new name with "save as" the arguments will now belong to
the buffer with the new name.


1.4.4 Hardcopy                                             *bashsupport-run-4*
--------------

Normal mode, insert mode: a Postscript file is made from the whole file.
Visual mode             : a Postscript file is made from the marked area.


1.4.5 Xterm size                                           *bashsupport-run-5*
----------------

The size of the xterm (see below) can be changes for the current session.  The
size has to be specified as COLUMNS LINES (e.g. 96 32 ).

1.4.6 Output redirection                                   *bashsupport-run-6*
------------------------

The last menu entry 'output: ... ' has 3 states:
  'output: VIM->buffer->xterm'
  'output: BUFFER->xterm->vim'
  'output: XTERM->vim->buffer'
The first state (upper-case) is the current one.

Target VIM
----------
The script is run from the command line like  ":!./% arguments".
* This is suitable for scripts with dialog elements and few lines of output.

Target BUFFER
-------------
The shell output will be displayed in a window with name "Bash-Output".  This
buffer and its content will disappear when the window is closed.  It is not
writable and it has no file. The content could be saved with "save as".
If the output fits completely into this window the cursor will stay in the
script window otherwise the cursor will be set into the output window (you may
want to scroll).
When the script is run again and the output buffer is still open it will be
reused.

The buffer will not be opened if the script does not produce anny output.
This is for convenience; you do not have to close an empty buffer.

* This is suitable for scripts without dialog elements and many lines of output
* (e.g. from options like xtrace). Use Vim as pager (scroll, jump, search with
* regular expressions, .. )

Target XTERM
------------
The script will be run in a xterm-window. A wrapper script will ask you to
close this window with Return or <C-D> (bash).
The wrapper shows the complete command line and the return code of the script.

* This is suitable for scripts with dialog elements and many lines of output.
* The xterm is scrollable and independent from the editor window.

Appearance of the xterm
-----------------------
The appearance of the xterm can be controlled by the global variable
g:BASH_XtermDefaults. The assignment 

  let g:BASH_XtermDefaults = "-fa courier -fs 10 -geometry 96x32"

placed in .vimrc would override the defaults. The defaults are

  "-fa courier -fs 12 -geometry 80x24"

FreeType font 'courier', FreeType font size 12 point, window width 80
characters, window height 24 lines.

The default output method is VIM. The preferred output method can be selected
in .vimrc by the global variable g:BASH_OutputGvim, e.g.

  let g:BASH_OutputGvim            = "xterm"

The methods are "vim", "buffer" and "xterm".

==============================================================================
2.  USAGE without GUI  (Vim)                           *bashsupport-usage-vim*
==============================================================================

The frequently used constructs can be inserted with key mappings:

  -- Load / Unload bash Support ------------

  \lbs    Load Bash Support    (normal)
  \ubs    Unload Bash Support  (normal)

  -- Comments ------------------------------

  \cl     Line End Comment             (normal)
  \cf     Frame Comment                (normal)
  \cu     Function Description         (normal)
  \ch     File Header                  (normal)
  \ckb    Keyword comment BUG          (normal)
  \ckt    Keyword comment TODO         (normal)
  \ckr    Keyword comment TRICKY       (normal)
  \ckw    Keyword comment WARNING      (normal)
  \ckn    Keyword comment New_Keyword  (normal)
  \cc     code to comment              (visual)
  \co     comment to code              (visual)
  \cd     Date                         (normal)
  \ct     Date & Time                  (normal)
  \cv     vim modeline                 (normal)
                                     
  -- Statements ----------------------------

  \ac     case in ... esac             (normal)
  \al     elif then                    (normal)
  \af     for in do done               (normal, visual)
  \ai     if then fi                   (normal, visual)
  \ae     if then else fi              (normal, visual)
  \as     select in do done            (normal, visual)
  \at     until do done                (normal, visual)
  \aw     while do done                (normal, visual)
  \ao     echo "..."                   (normal, visual)
  \av     remove echo "..."            (normal)

  -- Run -----------------------------------

  \re     make script executable           (normal)
  \rh     hardcopy buffer to FILENAME.ps   (normal)


File bash-hot-keys.pdf contains a reference card for these key mappings.
Multiline inserts and code snippets will be indented after insertion.

The hotkeys are defined in the filetype plugin sh.vim (part of this
bash-support plugin package).


==============================================================================
3.  HOTKEYS                                              *bashsupport-hotkeys*
==============================================================================

The following hotkeys are defined in NORMAL, VISUAL and INSERT MODE: 

    Ctrl-F9   run script
     Alt-F9   run syntax check
   Shift-F9   command line arguments (for the current buffer)


==============================================================================
4.0  CUSTOMIZATION                                        *bashsupport-custom*
==============================================================================

------------------------------------------------------------------------------
4.1  FILES                                              *bashsupport-custom-1*
------------------------------------------------------------------------------

README.bashsupport        This file.

codesnippets-bash/*       Some code snippets as a starting point.

doc/bashsupport.txt       The help file for the local online help. 

ftplugin/sh.vim           A filetype plugin. Define hotkeys, creates a local dictionary 
                          for each bash file.

plugin/bash-support.vim   The bash plugin for Vim/gVim.
plugin/wrapper.sh         The wrapper script for the use with a xterm.

plugin/templates/bash-file-header           -+-  bash template files 
plugin/templates/bash-frame                  |   (see bashsupport.txt)
plugin/templates/bash-function-description  -+

wordlists/bash.list       A file with words used as dictionary for automatic word 
                          completion. This file is referenced in the file 
                          customization.vimrc .

-----------------------   -------------------------------------------------------------
-----------------------   The following files and extensions are for convenience only.
                          bash-support.vim will work without them.
                          -------------------------------------------------------------

rc/customization.vimrc    Additional settings I use in  .vimrc:  incremental search,
                          tabstop, hot keys, font, use of dictionaries, ...
                          The file is commented. Append it to your .vimrc if you like.

rc/customization.gvimrc   Additional settings I use in  .gvimrc:
                            hot keys, mouse settings, ...
                          The file is commented. Append it to your .gvimrc if you like.

doc/bash-hot-keys.pdf     Reference card for the key mappings. 
                          The mappings can be used with the non-GUI Vim, 
                          because the menus are not available.

------------------------------------------------------------------------------
4.2  GLOBAL VARIABLES                                   *bashsupport-custom-2*
------------------------------------------------------------------------------

Several global variables are checked by the script to customize it:

---------------------------------------------------------------------------------------
global variable            default value            tag (see |bashsupport-tempfiles-2|)
---------------------------------------------------------------------------------------
g:BASH_AuthorName          ""                                |AUTHOR|
g:BASH_AuthorRef           ""                                |AUTHORREF|
g:BASH_Email               ""                                |EMAIL|
g:BASH_Company             ""                                |COMPANY|   
g:BASH_Project             ""                                |PROJECT|
g:BASH_CopyrightHolder     ""                                |COPYRIGHTHOLDER|

g:BASH_Template_Directory  $HOME."/.vim/plugin/templates/"
g:BASH_Template_File       "bash-file-header"
g:BASH_Template_Frame      "bash-frame"
g:BASH_Template_Function   "bash-function-description"

g:BASH_CodeSnippets        $HOME."/.vim/codesnippets-bash"
g:BASH_LoadMenus           "yes"
g:BASH_Dictionary_File     $HOME."/.vim/wordlists/bash.list"
g:BASH_Root                'B&ash.'

g:BASH_OutputGvim          "vim"
g:BASH_XtermDefaults       "-fa courier -fs 12 -geometry 80x24"

--------------------------------------------------------------------------------

1. group: Defines the text which will be inserted for the tags when a template  
          is read in (see |bashsupport-tempfiles|).

          g:BASH_AuthorName      : author name
          g:BASH_AuthorRef       : author reference (e.g. acronym)
          g:BASH_Email           : email address
          g:BASH_Company         : name of the company / institution
          g:BASH_Project         : project
          g:BASH_CopyrightHolder : the copyright holder

2. group: Sets the template directory and the names of the template files (see below).

3. group: g:BASH_CodeSnippets    : The name of the code snippet directory 
                                   (see |bashsupport-stat-3|).
          g:BASH_LoadMenus       : Load menus and mappings ("yes", "no") at startup.
          g:BASH_Dictionary_File : Path and filename of the bash word list used for
                                   dictionary completion (see |bashsupport-dictionary|).
          g:BASH_Root            : The name of the root menu entry of this plugin 
                                   (see |bashsupport-custom-3|).

4. group: g:BASH_OutputGvim      : Target for a script output (see |bashsupport-run-6|).
          g:BASH_XtermDefaults   : The xterm defaults (see |bashsupport-run-5|).
          
To override the defaults add appropriate assignments in .vimrc .
Here are my settings as an example:

  let g:BASH_AuthorName      = "Dr.-Ing. Fritz Mehner"     
  let g:BASH_AuthorRef       = "Mn"                         
  let g:BASH_Email           = "mehner@fh-swf.de"            
  let g:BASH_Company         = "FH Südwestfalen, Iserlohn"    

------------------------------------------------------------------------------
4.3  THE ROOT MENU                                      *bashsupport-custom-3*
------------------------------------------------------------------------------

The variable g:BASH_Root, if set (in .vimrc or in .gvimrc), gives the name of
the single gVim root menu entry in which the Bash submenus will be put. 
The default is 
                  'B&ash.'
Note the terminating dot. A single root menu entry is appropriate if the
screen is limited or several plugins are in use.

If set to "", this single root menu entry will not appear.  Now all submenus
are put into the gVim root menu. Nice for a Bash-only-programmer and Bash
courses. 


==============================================================================
5.  TEMPLATE FILES AND TAGS                            *bashsupport-tempfiles*
==============================================================================

------------------------------------------------------------------------------
5.1  TEMPLATE FILES                                  *bashsupport-tempfiles-1*
------------------------------------------------------------------------------

Three menu entries generate block comments:

    bash -> Comments -> Frame Comment
    bash -> Comments -> Function Description
    bash -> Comments -> File Header

The comments which will be inserted by these menu entries are read from 
template files:

------------------------------------------------------------------------------
MENU ENTRY              FILE                          GLOBAL VARIABLE         
------------------------------------------------------------------------------
Frame Comment           bash-frame                    g:BASH_Template_Frame   
Function Description    bash-function-description     g:BASH_Template_Function
File Header             bash-file-header              g:BASH_Template_File    
------------------------------------------------------------------------------

The template files can be written or changed by the user to fulfill special
requirements (layout for a project or workgroup already exists, file headers /
blocks have to be prepared for a documentation tool, ... ).  They can hold not
only comments but a complete file skeleton if this is necessary.  So you may
want to lay out your own templates.

------------------------------------------------------------------------------
5.2  TAGS                                            *bashsupport-tempfiles-2*
------------------------------------------------------------------------------
The comments in these files do not have to be personalized but they can be.
The text can contain the following tags which are replaced by the appropriate
information when the file is read in:

    |AUTHOR|
    |DATE|
    |EMAIL|
    |FILENAME|
    |YEAR|

    |AUTHORREF|
    |COMPANY|
    |COPYRIGHTHOLDER|
    |PROJECT|
    |TIME|

    |CURSOR|

Each tag can occur more than once. The tag |CURSOR| may appear only once.
The tag |CURSOR| will be the cursor position after the block is read in.
There is no need to use any of these tags, some or all can be missing.

The template files can actually be links pointing to existing templates.


==============================================================================
6.  BASH DICTIONARY                                   *bashsupport-dictionary*
==============================================================================

The file  bash.list  contains words used as dictionary for automatic word
completion.  This feature is enabled by default. The default word list is

  $HOME/.vim/wordlists/bash.list

If you want to use an additional list MyBash.List put the following line into
 $HOME/.vimrc :

  let g:BASH_Dictionary_File   =  "$HOME/.vim/wordlists/bash.list,".
                              \   "$HOME/.vim/wordlists/MyBash.List"

The right side is a comma separated list of files. Note the point at the end
of the first line (string concatenation) and the backslash in front of the 
second line (continuation line). 
You can use Vim's dictionary feature CTRL-X, CTRL-K (and CTRL-P, CTRL-N).


==============================================================================
7.  Release Notes                                  *bashsupport-release-notes*
==============================================================================

See file README.bashsupport .

==============================================================================
vim:tw=78:noet:ts=2:ft=help:norl:
